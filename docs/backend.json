{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Baradari.web chat application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier from Firebase Auth."
        },
        "username": {
          "type": "string",
          "description": "Unique, user-chosen display name."
        },
        "nickname": {
          "type": "string",
          "description": "User's chosen display name (not unique)."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "profilePhoto": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short user biography."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "lastSeen": {
          "type": "string",
          "description": "Timestamp of when the user was last active.",
          "format": "date-time"
        },
        "fcmToken": {
          "type": "string",
          "description": "Firebase Cloud Messaging token for push notifications."
        },
        "status": {
          "type": "string",
          "description": "User's online status.",
          "enum": ["online", "offline"]
        },
        "appLockEnabled": {
          "type": "boolean",
          "description": "Flag to indicate if the app lock is enabled."
        },
        "appLockPassword": {
          "type": "string",
          "description": "Hashed password for the app lock feature."
        }
      },
      "required": ["uid", "username", "nickname", "email", "createdAt", "status"]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat session between two or more users.",
      "properties": {
        "chatId": {
          "type": "string",
          "description": "Unique identifier for the chat."
        },
        "participants": {
          "type": "array",
          "description": "An array of user UIDs participating in the chat.",
          "items": { "type": "string" }
        },
        "lastMessage": {
          "type": "string",
          "description": "The text of the last message sent in the chat."
        },
        "lastMessageTime": {
          "type": "string",
          "description": "Timestamp of the last message.",
          "format": "date-time"
        },
        "isBroadcast": {
          "type": "boolean",
          "description": "Flag to indicate if this is a broadcast-only chat."
        }
      },
      "required": ["chatId", "participants", "lastMessageTime"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a chat.",
      "properties": {
        "messageId": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "senderId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "text": {
          "type": "string",
          "description": "The plain text content of the message (for UI display)."
        },
        "encryptedText": {
          "type": "string",
          "description": "The encrypted content of the message (for storage)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "seen": {
          "type": "boolean",
          "description": "Flag indicating if the message has been seen by the receiver."
        }
      },
      "required": ["messageId", "senderId", "encryptedText", "timestamp"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{uid}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores public user profiles, accessible for searching and starting new chats."
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": { "$ref": "#/backend/entities/Chat" },
          "description": "Stores metadata for each chat session. Rules ensure only participants can read/write."
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": { "$ref": "#/backend/entities/Message" },
          "description": "Subcollection for messages within a chat. This structure is secure and scalable."
        }
      }
    ]
  }
}
